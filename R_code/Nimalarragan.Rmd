---
title: "Nimalarragan Invertebrate Analysis"
author: "Adrian Pinder"
date and time: '`r Sys.time()`'
output: html_document
software: 'RStudio: Version 1.1.463 – © 2009-2018 RStudio, Inc. R version: `r getRversion()`'
editor_options: 
  chunk_output_type: console
---
  
Git repository https://github.com/AdrianMP62/Nimalarragan  

RStudio: Version 1.1.463 – © 2009-2018 RStudio, Inc. R version: `r getRversion()`  
Date and time: `r Sys.time()`

Uses the following datafiles:  
*  Invert_matrix.csv (System,	SurveyType,	SiteName,	SiteCode,	Subsite	Date,	CommonName,	SpeciesCode,	Count) (e.g. Warden,	aerial,	Neridup Suite,	WRP001,	combined,	11/10/2006,	Great Egret,	greg,	1)



Date and time: `r Sys.time()`

```{r setup, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(include = FALSE)
```

```{r}
options(scipen=999)
```

```{r results="hide", warning=FALSE, message=FALSE}
Packages <- c("vegan", "data.table", "ggrepel", "ggplot2", "stringr", "reshape2", "knitr", "simba", "zoo", "car")
lapply(Packages, library, character.only = TRUE)
#source("./functions/bio_env_ext.R") #The Bio_env and bv_step_ext routines below comes from http://menugget.blogspot.com.au/2011/06/clarke-and-ainsworths-bioenv-and-bvstep.html
```

```{r}
set.seed(1234)
```


#Analyses of invertebrate samples from Nimalarragan wetland north of Broome
  
  
##Import data
```{r import-and-restructure-Warden-and-Gore-waterbird-data}
input.data <- read.csv("./raw_data/Invert_matrix.csv")
input.data$sample_long <- paste(input.data$SiteCode, input.data$Sample, sep = " ")
input.data$taxon <- paste(input.data$LowestIDNC, input.data$LowestID, sep = " ") 
input.data$taxon <- gsub(" ", "_", input.data$taxon)
```

##Create matrix
```{r create-matrix-for-ordination}
invert.matrix <- melt(input.data) #melt data 
  invert.matrix <- dcast(invert.matrix, sample_long ~ taxon, fill="0") #create matrix from flat-file
  rownames(invert.matrix) <- invert.matrix [,1] #use first column (season) as row.names
  invert.matrix [,1] <- NULL #remove season column
  invert.matrix <- data.matrix(invert.matrix, rownames.force = NA) #convert data to numeric format
  #invert.matrix <- t(invert.matrix)
write.csv(invert.matrix, "./outputs/invert_matrix.csv")
```

##create plankton only dataset
```{r}
invert.matrix.P <- invert.matrix[grep("P", row.names(invert.matrix)), ]
invert.matrix.P <- invert.matrix.P[, colSums(invert.matrix.P)>0 ]
#write.csv(invert.matrix.P, "./outputs/invert_matrix_P.csv")
```

```{r}
#specify rows to remove - creating new data file
invert.matrix.Pred <- subset(invert.matrix.P, select=-c(IF999999_Turbellaria,JB999999_Bdelloidea,MM239999_Arrenuridae,MM999901_Acarina,QC0999A6_Bidessini,QC110499_Berosus_sp.,QD099999_Ceratopogonidae,QH520199_Mesovelia_sp.,QH670499_Anisops_sp.,QO021099_Ischnura_sp.,QO129999_Aeshnidae))
invert.matrix.Pred <- as.data.frame(invert.matrix.Pred) #convert to data.frame to allow calculations
#merge Gerridae with Limnogonus and delete Gerridae
invert.matrix.Pred$QH570399_Limnogonus_sp. <- pmax(invert.matrix.Pred$QH570399_Limnogonus_sp., invert.matrix.Pred$QH579999_Gerridae)
invert.matrix.Pred$QH579999_Gerridae <- NULL #delete Gerridae
#merge Pleidae with P.brunni and delete P. brunni
invert.matrix.Pred$QH680199_Paraplea_sp. <- pmax(invert.matrix.Pred$QH680199_Paraplea_sp., invert.matrix.Pred$QH680101_Paraplea_brunni)
invert.matrix.Pred$QH680101_Paraplea_brunni <- NULL #delete Gerridae
```







```{r}
invert.spec.P <-specaccum(t(invert.matrix.P), method="rarefaction")
invert.spec.P
```


```{r}
invert.mds.P <- 
```










